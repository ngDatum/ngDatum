angular.module("nd",[]),angular.module("nd").directive("ndBarchart",function(){function a(a,b){return"translate("+a+","+b+")"}function b(b,c,d){var e=[];d.fanciness&&(e=d.fanciness.split(",").map(function(a){return a.trim()}));var f={"short":"%b-%d",med:"%b-%d '%y","long":""},g=b.margins||{},h=b.size||{},i=b.labels||{},j={},k=i.x||"NEED X LABEL",l=i.y||"NEED Y LABEL";j.left=g.left||35,j.right=g.right||30,j.top=g.top||50,j.bottom=g.bottom||55;var m=(h.width||800)-j.left-j.right,n=(h.height||400)-j.top-j.bottom;if(b.timeformat){var o=b.timeformat.format,p=f[o]?f[o]:o,q=d3.time.format(p);b.dataSet.forEach(function(a){a[k]=q(new Date(a[k]))})}var r=d3.scale.ordinal().domain(b.dataSet.map(function(a){return a[k]})).rangeBands([0,m],.1),s=0,t=d3.max(b.dataSet,function(a){return a[l]}),u=d3.scale.linear().domain([s,t]).range([n,0]),v=d3.svg.axis().scale(r).orient("bottom"),w=d3.svg.axis().scale(u).orient("left"),x=d3.select(c[0]).append("svg").attr("width",m+j.left+j.right).attr("height",n+j.top+j.bottom).attr("class","svgContainer"),y=x.append("g").attr("transform",a(j.left,j.top)).attr("class","innerSpace");y.append("g").attr("transform",a(0,n)).attr("class","nd-barchart-xaxis").call(v).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".30em").attr("font-size",11).attr("transform",function(){return"rotate(-45)"});var z=(y.append("g").attr("class","nd-barchart-yaxis").call(w).append("text").attr("y",-4).attr("dy",".61em").attr("transform","rotate(-90)").style("text-anchor","end").style("fill","slategrey").text(l.charAt(0).toUpperCase()+l.slice(1)),y.selectAll(".bar").data(b.dataSet).enter().append("rect").attr("class","bar").attr("x",r(0)).attr("y",u(0)).attr("height",0));e.push("defaultVis");var A={};A.emphasizeLow=function(){z.style("opacity",function(a){return 1-.5*a[l]/t})},A.emphasizeHigh=function(){z.style("opacity",function(a){return.5+.5*a[l]/t})},A.tip=function(){var a=d3.select(c[0]).append("div").attr("class","nd-tooltip");z.on("mouseover",function(b){return a.html("<strong>"+b[k]+"</strong><br>"+b[l]),a.style("visibility","visible")}).on("mousemove",function(){return a.style("top",event.pageY-12+"px").style("left",event.pageX+12+"px")}).on("mouseout",function(){return a.style("visibility","hidden")})};var B=["bounceUp","bounceDown","grow","stepGrow"];A.defaultVis=function(){var a=e.every(function(a){return-1===B.indexOf(a)?!0:void 0});a&&z.attr("x",function(a){return r(a[k])}).attr("y",function(a){return u(a[l])}).attr("width",r.rangeBand()).attr("height",function(a){return n-u(a[l])})},A.bounceUp=function(){z.transition().attr("x",function(a){return r(a[k])}).attr("y",function(a){return u(a[l])}).duration(2e3).delay(50).ease("elastic").attr("width",r.rangeBand()).attr("height",function(a){return n-u(a[l])})},A.grow=function(){z.transition().duration(1e3).attr("x",function(a){return r(a[k])}).attr("y",function(a){return u(a[l])}).attr("width",r.rangeBand()).attr("height",function(a){return n-u(a[l])})},A.stepGrow=function(){z.transition().duration(function(a,c){return 1100+c/b.dataSet.length*1800}).attr("x",function(a){return r(a[k])}).attr("y",function(a){return u(a[l])}).attr("width",r.rangeBand()).attr("height",function(a){return n-u(a[l])})},e.forEach(function(a){A[a]()})}return{restrict:"E",scope:{dataSet:"=data",margins:"=",size:"=",labels:"=",timeformat:"="},link:b}}),angular.module("nd").directive("ndDonutchart",function(){function a(a,b){var c=(a.margins||{},a.size||{}),d=(a.labels||{},c.width||360),e=c.height||360,f=Math.min(d,e)/2,g=75,h=d3.scale.category20b(),i=d3.select(b[0]).append("svg").attr("width",d).attr("height",e).append("g").attr("transform","translate("+d/2+","+e/2+")"),j=d3.svg.arc().innerRadius(f-g).outerRadius(f),k=d3.layout.pie().value(function(a){return a.count}).sort(null),l=(i.selectAll("path").data(k(a.dataSet)).enter().append("path").attr("d",j).attr("fill",function(a){return h(a.data.label)}),18),m=4,n=i.selectAll(".legend").data(h.domain()).enter().append("g").attr("class","legend").attr("transform",function(a,b){var c=l+m,d=c*h.domain().length/2,e=-2*l,f=b*c-d;return"translate("+e+","+f+")"});n.append("rect").attr("width",l).attr("height",l).style("fill",h).style("stroke",h),n.append("text").attr("x",l+m).attr("y",l-m).text(function(a){return a})}return{restrict:"E",scope:{dataSet:"=data",margins:"=",size:"=",labels:"=",timeformat:"="},link:a}}),angular.module("nd").directive("ndLinechart",function(){function a(a,b){return"translate("+a+","+b+")"}function b(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;p=b.margins||{},q=b.size||{},m=b.labels||{},d={},d.left=p.left||35,d.right=p.right||30,d.top=p.top||50,d.bottom=p.bottom||55,e=(q.width||800)-d.left-d.right,f=(q.height||400)-d.top-d.bottom,g=d3.time.scale().range([0,e]),h=d3.scale.linear().range([f,0]),m=b.labels||{},n=m.x||"NEED X LABEL",o=m.y||"NEED Y LABEL",i=d3.svg.axis().scale(g).orient("bottom").tickFormat(d3.time.format("%b-%d")),j=d3.svg.axis().scale(h).orient("left"),k=d3.svg.line().x(function(a){return g(a[n])}).y(function(a){return h(a[o])}),l=d3.select(c[0]).append("svg").attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom).append("g").attr("class","nd-linechart").attr("transform",a(d.left,d.top)),g.domain(d3.extent(b.dataSet,function(a){return a[n]})),h.domain([0,d3.max(b.dataSet,function(a){return a[o]})]),l.append("path").attr("class","valueline").attr("d",k(b.dataSet)),l.append("g").attr("class","xaxis").attr("transform",a(0,f)).call(i).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-65)"}),l.append("g").attr("class","yaxis").call(j)}return{restrict:"E",scope:{dataSet:"=data",margins:"=",size:"=",labels:"=",timeformat:"="},link:b}}),angular.module("nd").directive("ndMultilinechart",function(){function a(a,b){return"translate("+a+","+b+")"}function b(b,c,d){function e(){return d3.svg.axis().scale(k).orient("bottom").ticks(5)}function f(){return d3.svg.axis().scale(l).orient("left").ticks(5)}function g(){var a=Number.NEGATIVE_INFINITY;return b.dataSet.forEach(function(b){a=Math.max(a,d3.max(b,function(a){return a[s]}))}),a}var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;t=b.margins||{},u=b.size||{},q=b.labels||{},h={},h.left=t.left||50,h.right=t.right||20,h.top=t.top||30,h.bottom=t.bottom||110,w=d3.scale.category10(),i=(u.width||800)-h.left-h.right,j=(u.height||400)-h.top-h.bottom,x=i/b.dataSet.length,v=d.legends.split(",").map(function(a){return a.trim()}),k=d3.time.scale().range([0,i]),l=d3.scale.linear().range([j,0]),q=b.labels||{},r=q.x||"NEED X LABEL",s=q.y||"NEED Y LABEL",m=d3.svg.axis().scale(k).orient("bottom").tickFormat(d3.time.format("%b-%d")),n=d3.svg.axis().scale(l).orient("left"),o=d3.svg.line().interpolate("monotone").x(function(a){return k(a[r])}).y(function(a){return l(a[s])}),p=d3.select(c[0]).append("svg").attr("width",i+h.left+h.right).attr("height",j+h.top+h.bottom).append("g").attr("class","nd-multilinechart").attr("transform",a(h.left,h.top)),k.domain(d3.extent(b.dataSet[0],function(a){return a[r]})),l.domain([0,g()]),b.dataSet.forEach(function(a,b){p.append("path").attr("class","valueline").attr("d",o(a)).attr("id","tag"+v[b]).style("stroke",w(b)),p.append("text").attr("x",x/2+b*x).attr("y",j+h.bottom/1.5).attr("class","legend").style("fill",function(){return w(b)}).on("click",function(){var c=a.active?!1:!0;newOpacity=c?0:1,d3.select("#tag"+v[b]).transition().duration(100).style("opacity",newOpacity),a.active=c}).text(v[b])}),p.append("g").attr("class","xaxis").attr("transform",a(0,j)).call(m).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-35)"}),p.append("g").attr("class","yaxis").call(n),p.append("g").attr("class","grid").attr("transform",a(0,j)).style("fill","red").call(e().tickSize(-j,0,0).tickFormat("")),p.append("g").attr("class","grid").call(f().tickSize(-i,0,0).tickFormat(""))}return{restrict:"E",scope:{dataSet:"=data",margins:"=",size:"=",labels:"=",timeformat:"="},link:b}});